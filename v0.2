#include <iostream>
#include <fstream>
#include <vector>
#include <string>
#include <iomanip>

using namespace std;

// структура для хранения данных по сменам
struct Shift
{
	string date;
	double hourlyRate;
	double hoursWorked;
	double planPercent;
	double payment;
};

// функция для рассчета оплаты за отдельную смену
// доработать и унифицировать для функции редактирования смен
double calculateShiftPayment(double hourlyRate, double hoursWorked, double planPercent)
{
	return hourlyRate * hoursWorked + (hourlyRate * hoursWorked * (planPercent / 100));
}

// функция для редактирования смены
// в дальнейшем вывести в вызываемый блок
void redactShift(vector<Shift>& shifts)
{
	int num;
	cout << "Номер смены для редактирования (1-" << shifts.size() << "): ";
	cin >> num;
	if (num <1 || num>shifts.size())
	{
		cout << "Ошибка: неверный номер смены." << endl;
		return;
	}
	Shift& shift = shifts[num - 1];

	cout << "Редактирование смены: " << endl;
	cout << "Текущая дата: " << shift.date << endl;
	cout << "Введите новую дату (дд.мм.; оставить пустым для сохранения текущего): ";
	string newDate;
	cin.ignore();
	getline(cin, newDate);
	if (!newDate.empty())
	{
		shift.date = newDate;
	}

	cout << "Текущие часы: " << shift.hoursWorked << endl;
	cout << "Введите новые часы (оставить пустым для сохранения текущего): ";
	string newHours;
	getline(cin, newHours);
	if (!newHours.empty())
	{
		shift.hoursWorked = stod(newHours);
		shift.payment = calculateShiftPayment(shift.payment / shift.hoursWorked, shift.hoursWorked, shift.planPercent);
	}

	cout << "Текущий процент плана: " << shift.planPercent << "% " << endl;
	cout << "Введите новый процент плана (оставить пустым для сохранения текущего): ";
	string newPlanPercent;
	getline(cin, newPlanPercent);
	if (!newPlanPercent.empty())
	{
		shift.planPercent = stod(newPlanPercent);
		shift.payment = calculateShiftPayment(shift.payment / shift.hoursWorked, shift.hoursWorked, shift.planPercent);
	}

	cout << "Смена успешно отредактирована." << endl;
}

// отдельная функция для записи данных в файл
// временная мера
void saveShifts(const vector<Shift>& shifts, ofstream& outFile)
{
	double totalPayday = 0.0;
	outFile << "Количество смен: " << shifts.size() << endl;

	for (const auto& shift : shifts)
	{
		outFile << "Дата смены: " << shift.date << ", Оплата за смену: " << fixed << setprecision(2) << shift.payment << " рублей" << endl;
		totalPayday += shift.payment;
	}

	outFile << "Общая зарплата: " << fixed << setprecision(2) << totalPayday << " рублей" << endl;
}

int main()
{
	setlocale(LC_ALL, "Russian");

	int numberOfShifts;

	cout << "Введите кол-во смен: ";
	cin >> numberOfShifts;

	vector<Shift>shifts;

	// Запись информации по каждой смене
	for (int i = 0; i < numberOfShifts; ++i)
	{
		Shift shift;
		cout << "Дата смены (дд.мм): ";
		cin >> shift.date;
		cout << "Часовая ставка: ";
		cin >> shift.hourlyRate;
		cout << "Кол-во отработанных часов: ";
		cin >> shift.hoursWorked;
		cout << "Процент выполненного плана (0-100): ";
		cin >> shift.planPercent;

		shift.payment = calculateShiftPayment(shift.hourlyRate, shift.hoursWorked, shift.planPercent);
		shifts.push_back(shift);
	}

	// Запись в файл
	ofstream outFile("payday_report.txt");
	if (!outFile)
	{
		cerr << "Ошибка открытия файла для записи!" << endl;
		return 1;
	}

	double totalPayday = 0.0;
	outFile << "Кол-во смен: " << numberOfShifts << endl;

	for (const auto& shift : shifts)
	{
		outFile << "Дата: " << shift.date << ", Оплата за смену: " << fixed << setprecision(2) << shift.payment << " рублей" << endl;
		totalPayday += shift.payment;
	}

	outFile << "Общая зарплата: " << fixed << setprecision(2) << totalPayday << " рублей" << endl;
	outFile.close();

	// Чтение из файла
	ifstream inFile("payday_report.txt");
	if (!inFile)
	{
		cerr << "Ошибка открытия файла для чтения!" << endl;
		return 1;
	}

	cout << "\n--- Отчет о зарплате ---\n";
	string line;
	while (getline(inFile, line))
	{
		cout << line << endl;
	}
	inFile.close();

	redactShift(shifts);

	// перезапись новых данных в файл
	outFile.open("payday_report.txt");
	if (!outFile)
	{
		cerr << "Ошибка открытия файла для записи!" << endl;
		return 1;
	}

	saveShifts(shifts, outFile);
	outFile.close();

	inFile.open("payday_report.txt");
	if (!inFile)
	{
		cerr << "Ошибка открытия файла для чтения!" << endl;
		return 1;
	}

	// вывод конечных данных из файла
	cout << "\n--- Отчет о зарплате ---\n";
	while (getline(inFile, line))
	{
		cout << line << endl;
	}
	inFile.close();

	return 0;
}
